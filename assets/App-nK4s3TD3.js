import{u as I,b as k,r as n,a as O,j as o,L as U,T as G}from"./index-CbBnwisx.js";import{S as t,D as A,M as z,a as f}from"./MenuButton-BTe-qOjR.js";import{O as F}from"./OpenFullAppButton-DI6_XFty.js";const J="_appContainer_b3ogb_2",q="_verticalTabContainer_b3ogb_9",K="_active_b3ogb_30",P="_widgetContainer_b3ogb_38",Q="_bordered_b3ogb_44",X="_badge_b3ogb_48",p={appContainer:J,verticalTabContainer:q,active:K,widgetContainer:P,bordered:Q,badge:X},Z=[{svc:t.None,label:"Your App"},{svc:t.Team,label:"Team Chat"},{svc:t.Drive,label:"Drive"},{svc:t.Contacts,label:"Contacts"},{svc:t.Meet,label:"Meetings"}],ee=({setService:c,service:l,currentService:g,disabled:i,children:v})=>o.jsx("button",{type:"button",onClick:i?void 0:()=>c(l),disabled:i,className:g===l?p.active:void 0,style:{position:"relative"},children:v}),T=[50,51,52,53],te=({hideDashboardElements:c,setHideDashboardElements:l})=>{const g=()=>{l(c?void 0:T)};return o.jsx("div",{children:o.jsx("button",{type:"button",className:`${f.menuButton} ${f.hideDashboardElementsButton}`,onClick:g,children:`${c?"Show":"Hide"} Dashboard Elements`})})},oe=({hideDashboardElements:c,setHideDashboardElements:l})=>{const g=i=>{var S;const E=Array.from((S=i.target)==null?void 0:S.options).filter(d=>d.selected).map(d=>Number(d.value));l(E.length>0?E:void 0)};return o.jsx("div",{children:o.jsx("select",{multiple:!0,onChange:g,value:c||[],className:`${f.menuButton} ${f.multiSelectHideDashboardElements}`,children:T.map(i=>o.jsx("option",{value:i,children:i},i))})})},ae=()=>{I();const c=k(),[l,g]=n.useState(""),[i,v]=n.useState(!0),[E,S]=n.useState(0),[d,M]=n.useState(!1),[y,W]=n.useState(!1),[s,B]=n.useState(()=>{const e=c.hash.slice(1);return e in t?t[e]:t.None}),[L,$]=n.useState(!1),[C,w]=n.useState(void 0),j=n.useRef(),u=n.useRef(),r=n.useRef(),b=O(e=>e.credentials),D=n.useCallback((e,{domain:a,token:x,hostId:Y},H)=>{console.log("Widget loading");const R=N=>{const m=new A({domain:a,sso:{token:x,hostId:Y},container:e},N);return m.on("room.READY",()=>{console.log("Entered meeting")}),m.on("room.UNLOAD",()=>{var h;console.log("Left meeting: re-creating widget..."),(h=r.current)==null||h.unload(),r.current=R(),r.current.on("dashboard.READY",()=>{$(_=>!_)})}),m.on("widget.ERROR",h=>{console.error("Widget error:",h),g(JSON.stringify(h))}),m};r.current=R(H),r.current.toggle(!1),r.current.on("dashboard.READY",()=>{M(!0),u.current=new A({domain:a,container:e},t.Team),u.current.toggle(!1),u.current.on("dashboard.UNREAD_MESSAGES",N=>{const m=Object.values(N.rooms).reduce((h,_)=>h+_,0);S(m)}),u.current.on("dashboard.READY",()=>{W(!0)})})},[]);n.useEffect(()=>{if(b.token&&b.domain&&b.hostId&&j.current)return D(j.current,b,s),()=>{var a,x;(a=r.current)==null||a.unload(),(x=u.current)==null||x.unload(),console.log("Widget unloaded")}},[b,D]),n.useEffect(()=>{d&&u.current.on("dashboard.NAVIGATE",e=>{const a=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${a}`)})},[d]),n.useEffect(()=>{var e,a;if((e=r.current)==null||e.toggle(!1),(a=u.current)==null||a.toggle(!1),v(s===t.None),s===t.None){console.log("Load your app"),window.history.pushState(null,"","#");return}s===t.Team?(u.current.toggle(!0),console.log("Load the team chat widget")):s===t.Meet?(r.current.toggle(!0),r.current.load(s,{hiddenElements:[]}),console.log("Load the Meet widget")):(r.current.toggle(!0),r.current.load(s),console.log(`Load the ${s} widget`)),window.history.pushState(null,"",`#${t[s]}`)},[s,L]),n.useEffect(()=>{var e;(e=r.current)==null||e.setHiddenElements(C)},[C]);const V=[p.widgetContainer,s!==t.None&&p.bordered].filter(Boolean).join(" ");return o.jsxs("div",{className:p.appContainer,children:[o.jsxs("div",{className:p.verticalTabContainer,children:[Z.map(({svc:e,label:a})=>o.jsxs(ee,{setService:B,service:e,currentService:s,disabled:!(e===t.Team?y:d),children:[a,e===t.Team&&o.jsx("span",{className:p.badge,children:E})]},e)),!d&&o.jsx(U,{error:l})]}),i&&o.jsx("div",{children:"Your app goes here"}),o.jsx(G,{position:"right"}),o.jsx(z,{position:"right"}),o.jsxs("div",{className:f.extraMenu,children:[s===t.Meet&&o.jsx(te,{hideDashboardElements:C,setHideDashboardElements:w}),s===t.Meet&&o.jsx(oe,{hideDashboardElements:C,setHideDashboardElements:w}),r.current&&o.jsx(F,{origin:`https://${b.domain}`})]}),o.jsx("div",{ref:j,className:V})]})};export{ae as default};
