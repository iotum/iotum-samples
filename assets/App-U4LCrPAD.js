import{r as e,j as t,u as y,a as D,T as N}from"./index-G96g-jsI.js";import{d as o,M as k}from"./MenuButton-sq7vA6Ar.js";const Y="_appContainer_1p9bj_2",M="_verticalTabContainer_1p9bj_9",I="_widgetContainer_1p9bj_37",L="_badge_1p9bj_43",h={appContainer:Y,verticalTabContainer:M,widgetContainer:I,badge:L},V=e.forwardRef(function(g,p){return t.jsx("div",{ref:p,className:h.widgetContainer})}),z=()=>{y();const[C,g]=e.useState(!0),[p,R]=e.useState(0),[j,w]=e.useState(!1),[i,E]=e.useState(!1),[c,d]=e.useState(o.Service.None),[A,T]=e.useState(!1),v=e.useRef(),a=e.useRef(),r=e.useRef(),l=D(n=>n.credentials),S=e.useCallback((n,{domain:s,token:b,hostId:_})=>{console.log("Widget loading");const x=()=>{const u=new o.Dashboard({domain:s,sso:{token:b,hostId:_},container:n});return u.on("room.READY",()=>{console.log("Entered meeting")}),u.on("room.UNLOAD",()=>{var f;console.log("Left meeting: re-creating widget..."),(f=r.current)==null||f.unload(),r.current=x(),r.current.on("dashboard.READY",()=>{T(m=>!m)})}),u};r.current=x(),r.current.toggle(!1),r.current.on("dashboard.READY",()=>{a.current=new o.Dashboard({domain:s,container:n},o.Service.Team),a.current.toggle(!1),a.current.on("dashboard.UNREAD_MESSAGES",u=>{const f=Object.values(u.rooms).reduce((m,W)=>m+W,0);R(f)}),a.current.on("dashboard.READY",()=>{E(!0),w(!0)})})},[]);return e.useEffect(()=>{if(l.token&&l.domain&&l.hostId&&v.current)return S(v.current,l),()=>{var s,b;(s=r.current)==null||s.unload(),(b=a.current)==null||b.unload(),console.log("Widget unloaded")}},[l,S]),e.useEffect(()=>{j&&a.current.on("dashboard.NAVIGATE",n=>{const s=n.pathname!=="/"?n.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${s}`)})},[j]),e.useEffect(()=>{var n,s;(n=r.current)==null||n.toggle(!1),(s=a.current)==null||s.toggle(!1),c===o.Service.None?(g(!0),console.log("Load your app")):c===o.Service.Team?(a.current.toggle(!0),g(!1),console.log("Load the team chat widget")):(r.current.toggle(!0),r.current.load(c),g(!1),console.log(`Load the ${c} widget`))},[c,A]),t.jsxs("div",{className:h.appContainer,children:[t.jsxs("div",{className:h.verticalTabContainer,children:[t.jsx("button",{type:"button",onClick:()=>d(o.Service.None),disabled:!i,children:"Your App"}),t.jsxs("button",{type:"button",onClick:()=>d(o.Service.Team),disabled:!i,style:{position:"relative"},children:["Team Chat",p>0&&t.jsx("span",{className:h.badge,children:p})]}),t.jsx("button",{type:"button",onClick:()=>d(o.Service.Drive),disabled:!i,children:"Drive"}),t.jsx("button",{type:"button",onClick:()=>d(o.Service.Contacts),disabled:!i,children:"Contacts"}),t.jsx("button",{type:"button",onClick:()=>d(o.Service.Meet),disabled:!i,children:"Meetings"})]}),C&&t.jsx("div",{children:"Your app goes here"}),!i&&t.jsx("div",{children:"The widgets are loading"}),t.jsx(N,{position:"right"}),t.jsx(k,{position:"right"}),t.jsx(V,{ref:v})]})};export{z as default};
