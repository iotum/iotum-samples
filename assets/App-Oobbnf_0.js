import{j as t,T as v,u as b,r as j,a as N}from"./index-wUJeLWl4.js";import{s as o,C}from"./ChatRoom-f8FGrI7v.js";import{M as k,d as h}from"./MenuButton-v_hvMF4P.js";const y=({rooms:c,onRoomButtonClick:l,onRoomClose:a})=>t.jsxs("div",{className:o.container,children:[t.jsx("div",{className:o.roomListContainer,children:c.map(e=>t.jsx("div",{className:o.chatRoomItem,children:t.jsx("button",{onClick:()=>l(e.path),className:e.bool?o.active:"",children:e.name})},e.path))}),t.jsxs("div",{className:o.chatRoomsContainer,children:[c.map(e=>e.bool&&t.jsxs("div",{className:`${o.chatRoom} ${o.activeRoom}`,children:[t.jsx(C,{path:e.path}),t.jsx("button",{className:o.closeButton,onClick:()=>a(e.path),children:"x"})]},e.path)),t.jsx(v,{position:"right"}),t.jsx(k,{position:"right"})]})]}),O=()=>{b();const[c,l]=j.useState([]),a=N(s=>s.credentials),e=(s,d)=>{l(u=>u.map(n=>n.path===s?{...n,bool:d}:n))},f=({domain:s,token:d,hostId:u})=>{const n=new h.Dashboard({domain:s,sso:{token:d,hostId:u},container:"#chat"},h.Service.Team,{layout:h.LayoutOption.list,pathname:"/"});return n.once("dashboard.ROOM_LIST",R=>{var x;const p=[],g=Object.values(R.rooms).map(m=>{const r=m.accounts.map(i=>i.name);if(r.length===1){const i=`${r[0]} (you)`;return p.push(r[0]),{name:i,path:m.path,bool:!1}}return{name:r.filter(i=>!p.includes(i)).join(", "),path:m.path,bool:!1}});l(g),(x=document.querySelector("#loading"))==null||x.remove()}),n};return j.useEffect(()=>{if(a&&a.token&&a.domain&&a.hostId){const s=f(a);return setTimeout(()=>s.toggle(!1)),()=>{s.unload()}}},[a]),t.jsxs("div",{children:[t.jsx("div",{id:"room-buttons",children:t.jsx(y,{rooms:c,onRoomButtonClick:s=>e(s,!0),onRoomClose:s=>e(s,!1)})}),t.jsx("div",{id:"chat",children:t.jsx("div",{id:"loading",children:"Loading..."})})]})};export{O as default};
