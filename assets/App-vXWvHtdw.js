import{r as s,j as n,u as H,a as k,T as L}from"./index-OptuiEFi.js";import{S as o,D as w,M as I,b as g}from"./MenuButton-G5JOkzV9.js";const U="_appContainer_12a7v_2",G="_verticalTabContainer_12a7v_9",z="_active_12a7v_30",O="_widgetContainer_12a7v_38",q="_badge_12a7v_44",b={appContainer:U,verticalTabContainer:G,active:z,widgetContainer:O,badge:q},F=s.forwardRef(function(c,h){return n.jsx("div",{ref:h,className:b.widgetContainer})}),J=[{svc:o.None,label:"Your App"},{svc:o.Team,label:"Team Chat"},{svc:o.Drive,label:"Drive"},{svc:o.Contacts,label:"Contacts"},{svc:o.Meet,label:"Meetings"}],K=({setService:v,service:c,currentService:h,disabled:E,children:d})=>n.jsx("button",{type:"button",onClick:E?void 0:()=>v(c),disabled:E,className:h===c?b.active:void 0,style:{position:"relative"},children:d}),X=()=>{H();const[v,c]=s.useState(!0),[h,E]=s.useState(0),[d,_]=s.useState(!1),[A,M]=s.useState(!1),[r,N]=s.useState(o.None),[W,y]=s.useState(!1),[u,R]=s.useState(void 0),x=s.useRef(),l=s.useRef(),a=s.useRef(),$=s.useRef(),m=k(e=>e.credentials),D=[50,51,52,53],B=()=>{const e=()=>{R(u?void 0:D)};return n.jsx("div",{children:n.jsx("button",{type:"button",className:`${g.menuButton} ${g.hideDashboardElementsButton} ${g.right}`,onClick:e,children:`${u?"Show":"Hide"} Dashboard Elements`})})},V=()=>{const e=t=>{var p;const C=Array.from((p=t.target)==null?void 0:p.options).filter(i=>i.selected).map(i=>Number(i.value));R(C.length>0?C:void 0)};return n.jsx("div",{children:n.jsx("select",{multiple:!0,onChange:e,ref:$,className:`${g.menuButton} ${g.multiSelectHideDashboardElements} ${g.right}`,children:D.map(t=>n.jsx("option",{value:t,selected:u?u.includes(t):!1,children:t},t))})})},T=s.useCallback((e,{domain:t,token:f,hostId:C})=>{console.log("Widget loading");const p=()=>{const i=new w({domain:t,sso:{token:f,hostId:C},container:e});return i.on("room.READY",()=>{console.log("Entered meeting")}),i.on("room.UNLOAD",()=>{var S;console.log("Left meeting: re-creating widget..."),(S=a.current)==null||S.unload(),a.current=p(),a.current.on("dashboard.READY",()=>{y(j=>!j)})}),i};a.current=p(),a.current.toggle(!1),a.current.on("dashboard.READY",()=>{_(!0),l.current=new w({domain:t,container:e},o.Team),l.current.toggle(!1),l.current.on("dashboard.UNREAD_MESSAGES",i=>{const S=Object.values(i.rooms).reduce((j,Y)=>j+Y,0);E(S)}),l.current.on("dashboard.READY",()=>{M(!0)})})},[]);return s.useEffect(()=>{if(m.token&&m.domain&&m.hostId&&x.current)return T(x.current,m),()=>{var t,f;(t=a.current)==null||t.unload(),(f=l.current)==null||f.unload(),console.log("Widget unloaded")}},[m,T]),s.useEffect(()=>{d&&l.current.on("dashboard.NAVIGATE",e=>{const t=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${t}`)})},[d]),s.useEffect(()=>{var e,t;(e=a.current)==null||e.toggle(!1),(t=l.current)==null||t.toggle(!1),r===o.None?(c(!0),console.log("Load your app")):r===o.Team?(l.current.toggle(!0),c(!1),console.log("Load the team chat widget")):r===o.Meet?(a.current.toggle(!0),a.current.load(r,{hiddenElements:[]}),c(!1),console.log("Load the Meet widget")):(a.current.toggle(!0),a.current.load(r),c(!1),console.log(`Load the ${r} widget`))},[r,W]),s.useEffect(()=>{var e;(e=a.current)==null||e.setHiddenElements(u)},[u]),n.jsxs("div",{className:b.appContainer,children:[n.jsx("div",{className:b.verticalTabContainer,children:J.map(({svc:e,label:t})=>n.jsxs(K,{setService:N,service:e,currentService:r,disabled:!(e===o.Team?A:d),children:[t,e===o.Team&&n.jsx("span",{className:b.badge,children:h})]},e))}),v&&n.jsx("div",{children:"Your app goes here"}),!d&&n.jsx("div",{children:"The widgets are loading"}),n.jsx(L,{position:"right"}),n.jsx(I,{position:"right"}),r===o.Meet&&B(),r===o.Meet&&V(),n.jsx(F,{ref:x})]})};export{X as default};
