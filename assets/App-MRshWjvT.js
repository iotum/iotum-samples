import{u as k,r as c,a as v,j as e,T as S}from"./index-0gxY_XVa.js";import{D as g,S as h,M as T}from"./MenuButton-n-Ss01AF.js";const w="_chatContainer_17vrk_2",A="_badge_17vrk_12",B="_biggerButton_17vrk_26",l={chatContainer:w,badge:A,biggerButton:B},M=()=>{k();const[m,b]=c.useState(0),[f,p]=c.useState(!0),a=c.useRef(null),o=v(t=>t.credentials),d=o.token&&o.domain&&o.hostId,x=t=>{var n;if(d)if((n=a.current)!=null&&n.instance)t();else{const{domain:i,token:u,hostId:r}=o;a.current=new g({domain:i,sso:{token:u,hostId:r},container:window,target:{name:"CallbridgeChatWidget",features:"width=800,height=600",checkExisting:!0}},h.Team),a.current.on("dashboard.READY",t),a.current.on("dashboard.NAVIGATE",s=>{console.log("navigate event:",s.service,s.pathname)})}},j=t=>{t.preventDefault();const{currentTarget:n}=t;n.disabled=!0;const i=setTimeout(()=>n.disabled=!1,2e3);x(()=>{clearTimeout(i),n.disabled=!1,a.current.instance.focus()})};return c.useEffect(()=>{if(d){const t=document.createElement("div"),{domain:n,token:i,hostId:u}=o,r=new g({domain:n,sso:{token:i,hostId:u},container:t},h.Team);return r.on("dashboard.UNREAD_MESSAGES",s=>{const C=Object.values(s.rooms).reduce((E,_)=>E+_,0);b(C),p(!1)}),()=>{var s;(s=a.current)==null||s.unload(),r==null||r.unload()}}},[d,o]),e.jsxs(e.Fragment,{children:[e.jsx(S,{position:"right"}),e.jsx(T,{position:"right"}),e.jsx("div",{className:l.chatContainer,children:f?e.jsx("div",{children:"Loading unread messages..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:l.biggerButton,onClick:j,children:"Chat"}),e.jsx("span",{className:l.badge,children:m})]})})]})};export{M as default};
