import{u as v,r as c,a as T,j as t,T as w,L as R}from"./index-BXCog4K2.js";import{D as l,S as h,M as A}from"./MenuButton-BiZLDXwy.js";const B="_chatContainer_17vrk_2",N="_badge_17vrk_12",D="_biggerButton_17vrk_26",g={chatContainer:B,badge:N,biggerButton:D},M=()=>{v();const[m,b]=c.useState(""),[f,p]=c.useState(0),[x,E]=c.useState(!0),r=c.useRef(null),o=T(n=>n.credentials),d=o.token&&o.domain&&o.hostId,j=n=>{var s;if(d)if((s=r.current)!=null&&s.instance)n();else{const{domain:i,token:u,hostId:a}=o;r.current=new l({domain:i,sso:{token:u,hostId:a},container:window,target:{name:"CallbridgeChatWidget",features:"width=800,height=600",checkExisting:!0}},h.Team),r.current.on("dashboard.READY",n),r.current.on("dashboard.NAVIGATE",e=>{console.log("navigate event:",e.service,e.pathname)})}},C=n=>{n.preventDefault();const{currentTarget:s}=n;s.disabled=!0;const i=setTimeout(()=>s.disabled=!1,2e3);j(()=>{clearTimeout(i),s.disabled=!1,r.current.instance.focus()})};return c.useEffect(()=>{if(d){const n=document.createElement("div"),{domain:s,token:i,hostId:u}=o,a=new l({domain:s,sso:{token:i,hostId:u},container:n},h.Team);return a.on("dashboard.UNREAD_MESSAGES",e=>{const S=Object.values(e.rooms).reduce((_,k)=>_+k,0);p(S),E(!1)}),a.on("widget.ERROR",e=>{console.error("Widget error:",e),b(JSON.stringify(e))}),()=>{var e;(e=r.current)==null||e.unload(),a==null||a.unload()}}},[d,o]),t.jsxs(t.Fragment,{children:[t.jsx(w,{position:"right"}),t.jsx(A,{position:"right"}),t.jsx("div",{className:g.chatContainer,children:x?t.jsx(R,{error:m,children:"Loading unread messages"}):t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:g.biggerButton,onClick:C,children:"Chat"}),t.jsx("span",{className:g.badge,children:f})]})})]})};export{M as default};
