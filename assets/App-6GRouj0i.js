import{r as t,j as o,u as D,a as Y,T as M}from"./index-0gxY_XVa.js";import{S as s,D as S,M as y}from"./MenuButton-n-Ss01AF.js";const I="_appContainer_12a7v_2",L="_verticalTabContainer_12a7v_9",V="_active_12a7v_30",k="_widgetContainer_12a7v_38",U="_badge_12a7v_44",p={appContainer:I,verticalTabContainer:L,active:V,widgetContainer:k,badge:U},B=t.forwardRef(function(i,d){return o.jsx("div",{ref:d,className:p.widgetContainer})}),G=[{svc:s.None,label:"Your App"},{svc:s.Team,label:"Team Chat"},{svc:s.Drive,label:"Drive"},{svc:s.Contacts,label:"Contacts"},{svc:s.Meet,label:"Meetings"}],z=({setService:f,service:i,currentService:d,disabled:v,children:c})=>o.jsx("button",{type:"button",onClick:v?void 0:()=>f(i),disabled:v,className:d===i?p.active:void 0,style:{position:"relative"},children:c}),q=()=>{D();const[f,i]=t.useState(!0),[d,v]=t.useState(0),[c,_]=t.useState(!1),[x,j]=t.useState(!1),[l,w]=t.useState(s.None),[A,E]=t.useState(!1),b=t.useRef(),r=t.useRef(),n=t.useRef(),u=Y(e=>e.credentials),T=t.useCallback((e,{domain:a,token:h,hostId:N})=>{console.log("Widget loading");const R=()=>{const g=new S({domain:a,sso:{token:h,hostId:N},container:e});return g.on("room.READY",()=>{console.log("Entered meeting")}),g.on("room.UNLOAD",()=>{var m;console.log("Left meeting: re-creating widget..."),(m=n.current)==null||m.unload(),n.current=R(),n.current.on("dashboard.READY",()=>{E(C=>!C)})}),g};n.current=R(),n.current.toggle(!1),n.current.on("dashboard.READY",()=>{_(!0),r.current=new S({domain:a,container:e},s.Team),r.current.toggle(!1),r.current.on("dashboard.UNREAD_MESSAGES",g=>{const m=Object.values(g.rooms).reduce((C,W)=>C+W,0);v(m)}),r.current.on("dashboard.READY",()=>{j(!0)})})},[]);return t.useEffect(()=>{if(u.token&&u.domain&&u.hostId&&b.current)return T(b.current,u),()=>{var a,h;(a=n.current)==null||a.unload(),(h=r.current)==null||h.unload(),console.log("Widget unloaded")}},[u,T]),t.useEffect(()=>{c&&r.current.on("dashboard.NAVIGATE",e=>{const a=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${a}`)})},[c]),t.useEffect(()=>{var e,a;(e=n.current)==null||e.toggle(!1),(a=r.current)==null||a.toggle(!1),l===s.None?(i(!0),console.log("Load your app")):l===s.Team?(r.current.toggle(!0),i(!1),console.log("Load the team chat widget")):(n.current.toggle(!0),n.current.load(l),i(!1),console.log(`Load the ${l} widget`))},[l,A]),o.jsxs("div",{className:p.appContainer,children:[o.jsx("div",{className:p.verticalTabContainer,children:G.map(({svc:e,label:a})=>o.jsxs(z,{setService:w,service:e,currentService:l,disabled:!(e===s.Team?x:c),children:[a,e===s.Team&&o.jsx("span",{className:p.badge,children:d})]},e))}),f&&o.jsx("div",{children:"Your app goes here"}),!c&&o.jsx("div",{children:"The widgets are loading"}),o.jsx(M,{position:"right"}),o.jsx(y,{position:"right"}),o.jsx(B,{ref:b})]})};export{q as default};
