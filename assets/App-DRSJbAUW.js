import{u as Y,b as $,r as o,a as O,j as n,L as U,T as G}from"./index-CRP2gdnx.js";import{S as t,D as T,M as z,a as v}from"./MenuButton-BDVW4cgm.js";import{O as F}from"./OpenFullAppButton-CS3qsTEl.js";const J="_appContainer_8a8vk_2",P="_verticalTabContainer_8a8vk_9",X="_active_8a8vk_30",q="_widgetContainer_8a8vk_38",K="_bordered_8a8vk_44",Q="_badge_8a8vk_49",b={appContainer:J,verticalTabContainer:P,active:X,widgetContainer:q,bordered:K,badge:Q},Z=[{svc:t.None,label:"Your App"},{svc:t.Team,label:"Team Chat"},{svc:t.Drive,label:"Drive"},{svc:t.Contacts,label:"Contacts"},{svc:t.Meet,label:"Meetings"}],ee=({setService:l,service:d,currentService:u,disabled:i,children:f})=>n.jsx("button",{type:"button",onClick:i?void 0:()=>l(d),disabled:i,className:u===d?b.active:void 0,style:{position:"relative"},children:f}),A=[50,51,52,53],te=({hideDashboardElements:l,setHideDashboardElements:d})=>{const u=()=>{d(l?void 0:A)};return n.jsx("div",{children:n.jsx("button",{type:"button",className:`${v.menuButton} ${v.hideDashboardElementsButton}`,onClick:u,children:`${l?"Show":"Hide"} Dashboard Elements`})})},ne=({hideDashboardElements:l,setHideDashboardElements:d})=>{const u=i=>{var E;const S=Array.from((E=i.target)==null?void 0:E.options).filter(c=>c.selected).map(c=>Number(c.value));d(S.length>0?S:void 0)};return n.jsx("div",{children:n.jsx("select",{multiple:!0,onChange:u,value:l||[],className:`${v.menuButton} ${v.multiSelectHideDashboardElements}`,children:A.map(i=>n.jsx("option",{value:i,children:i},i))})})},ae=()=>{Y();const l=$(),[d,u]=o.useState(""),[i,f]=o.useState(!0),[S,E]=o.useState(0),[c,M]=o.useState(!1),[k,y]=o.useState(!1),[s,W]=o.useState(()=>{const e=l.hash.slice(1);return e in t?t[e]:t.None}),[L,B]=o.useState(!1),[x,w]=o.useState(void 0),j=o.useRef(),g=o.useRef(),r=o.useRef(),p=O(e=>e.credentials),D=o.useCallback((e,{domain:a,token:C,hostId:H},V)=>{console.log("Widget loading");const R=N=>{const h=new T({domain:a,sso:{token:C,hostId:H},container:e},N);return h.on("room.READY",()=>{console.log("Entered meeting")}),h.on("room.UNLOAD",()=>{var m;console.log("Left meeting: re-creating widget..."),(m=r.current)==null||m.unload(),r.current=R(),r.current.on("dashboard.READY",()=>{B(_=>!_)})}),h.on("dashboard.SESSION_EXPIRED",()=>{console.error("Widget error:","Session expired"),u("Session expired")}),h.on("widget.ERROR",m=>{console.error("Widget error:",m),u(JSON.stringify(m))}),h};r.current=R(V),r.current.toggle(!1),r.current.on("dashboard.READY",()=>{M(!0),g.current=new T({domain:a,container:e},t.Team),g.current.toggle(!1),g.current.on("dashboard.UNREAD_MESSAGES",N=>{const h=Object.values(N.rooms).reduce((m,_)=>m+_,0);E(h)}),g.current.on("dashboard.READY",()=>{y(!0)})})},[]);o.useEffect(()=>{if(p.token&&p.domain&&p.hostId&&j.current)return D(j.current,p,s),()=>{var a,C;(a=r.current)==null||a.unload(),(C=g.current)==null||C.unload(),console.log("Widget unloaded")}},[p,D]),o.useEffect(()=>{c&&g.current.on("dashboard.NAVIGATE",e=>{const a=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${a}`)})},[c]),o.useEffect(()=>{var e,a;if((e=r.current)==null||e.toggle(!1),(a=g.current)==null||a.toggle(!1),f(s===t.None),s===t.None){console.log("Load your app"),window.history.pushState(null,"","#");return}s===t.Team?(g.current.toggle(!0),console.log("Load the team chat widget")):s===t.Meet?(r.current.toggle(!0),r.current.load(s,{hiddenElements:[]}),console.log("Load the Meet widget")):(r.current.toggle(!0),r.current.load(s),console.log(`Load the ${s} widget`)),window.history.pushState(null,"",`#${t[s]}`)},[s,L]),o.useEffect(()=>{var e;(e=r.current)==null||e.setHiddenElements(x)},[x]);const I=[b.widgetContainer,s!==t.None&&b.bordered].filter(Boolean).join(" ");return n.jsxs("div",{className:b.appContainer,children:[n.jsxs("div",{className:b.verticalTabContainer,children:[Z.map(({svc:e,label:a})=>n.jsxs(ee,{setService:W,service:e,currentService:s,disabled:!(e===t.Team?k:c),children:[a,e===t.Team&&n.jsx("span",{className:b.badge,children:S})]},e)),n.jsx("button",{type:"button",onClick:()=>r.current.load(t.Meet,{pathname:"/schedule",invitedContacts:[],invitedHosts:[]}),disabled:!c||[t.None,t.Team].includes(s),children:"Schedule"}),n.jsx(U,{error:d,isLoading:!c})]}),i&&n.jsx("div",{children:"Your app goes here"}),n.jsx(G,{position:"right"}),n.jsx(z,{position:"right"}),n.jsxs("div",{className:v.extraMenu,children:[s===t.Meet&&n.jsx(te,{hideDashboardElements:x,setHideDashboardElements:w}),s===t.Meet&&n.jsx(ne,{hideDashboardElements:x,setHideDashboardElements:w}),r.current&&n.jsx(F,{...p})]}),n.jsx("div",{ref:j,className:I})]})};export{ae as default};
