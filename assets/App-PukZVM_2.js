import{r as t,j as o,u as k,a as B,T as L}from"./index-e1Nq118p.js";import{S as s,D as T,M as I,b as R}from"./MenuButton-eGZ2Wt8n.js";const V="_appContainer_12a7v_2",H="_verticalTabContainer_12a7v_9",U="_active_12a7v_30",$="_widgetContainer_12a7v_38",G="_badge_12a7v_44",h={appContainer:V,verticalTabContainer:H,active:U,widgetContainer:$,badge:G},z=t.forwardRef(function(i,d){return o.jsx("div",{ref:d,className:h.widgetContainer})}),O=[{svc:s.None,label:"Your App"},{svc:s.Team,label:"Team Chat"},{svc:s.Drive,label:"Drive"},{svc:s.Contacts,label:"Contacts"},{svc:s.Meet,label:"Meetings"}],q=({setService:p,service:i,currentService:d,disabled:f,children:l})=>o.jsx("button",{type:"button",onClick:f?void 0:()=>p(i),disabled:f,className:d===i?h.active:void 0,style:{position:"relative"},children:l}),K=()=>{k();const[p,i]=t.useState(!0),[d,f]=t.useState(0),[l,_]=t.useState(!1),[j,w]=t.useState(!1),[r,D]=t.useState(s.None),[A,N]=t.useState(!1),[m,M]=t.useState(void 0),C=t.useRef(),c=t.useRef(),a=t.useRef(),u=B(e=>e.credentials),W=()=>{const e=()=>{M([50,51,52,53])};return o.jsx("button",{type:"button",className:`${R.menuButton} ${R.right}`,style:{top:"130px"},onClick:e,children:"Hide Dashboard Elements"})},S=t.useCallback((e,{domain:n,token:b,hostId:y})=>{console.log("Widget loading");const x=()=>{const g=new T({domain:n,sso:{token:b,hostId:y},container:e});return g.on("room.READY",()=>{console.log("Entered meeting")}),g.on("room.UNLOAD",()=>{var v;console.log("Left meeting: re-creating widget..."),(v=a.current)==null||v.unload(),a.current=x(),a.current.on("dashboard.READY",()=>{N(E=>!E)})}),g};a.current=x(),a.current.toggle(!1),a.current.on("dashboard.READY",()=>{_(!0),c.current=new T({domain:n,container:e},s.Team),c.current.toggle(!1),c.current.on("dashboard.UNREAD_MESSAGES",g=>{const v=Object.values(g.rooms).reduce((E,Y)=>E+Y,0);f(v)}),c.current.on("dashboard.READY",()=>{w(!0)})})},[]);return t.useEffect(()=>{if(u.token&&u.domain&&u.hostId&&C.current)return S(C.current,u),()=>{var n,b;(n=a.current)==null||n.unload(),(b=c.current)==null||b.unload(),console.log("Widget unloaded")}},[u,S]),t.useEffect(()=>{l&&c.current.on("dashboard.NAVIGATE",e=>{const n=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${n}`)})},[l]),t.useEffect(()=>{var e,n;(e=a.current)==null||e.toggle(!1),(n=c.current)==null||n.toggle(!1),r===s.None?(i(!0),console.log("Load your app")):r===s.Team?(c.current.toggle(!0),i(!1),console.log("Load the team chat widget")):r===s.Meet?(a.current.toggle(!0),m?a.current.load(r,{hiddenElements:m}):a.current.load(r),i(!1),console.log("Load the Meet widget")):(a.current.toggle(!0),a.current.load(r),i(!1),console.log(`Load the ${r} widget`))},[r,A,m]),o.jsxs("div",{className:h.appContainer,children:[o.jsx("div",{className:h.verticalTabContainer,children:O.map(({svc:e,label:n})=>o.jsxs(q,{setService:D,service:e,currentService:r,disabled:!(e===s.Team?j:l),children:[n,e===s.Team&&o.jsx("span",{className:h.badge,children:d})]},e))}),p&&o.jsx("div",{children:"Your app goes here"}),!l&&o.jsx("div",{children:"The widgets are loading"}),o.jsx(L,{position:"right"}),o.jsx(I,{position:"right"}),r===s.Meet&&!m&&W(),o.jsx(z,{ref:C})]})};export{K as default};
