import{u as H,b as O,r as n,a as k,j as o,L as U,T as G}from"./index-BXCog4K2.js";import{S as t,D as A,M as z,a as f}from"./MenuButton-BiZLDXwy.js";import{O as F}from"./OpenFullAppButton-Cc354g7T.js";const J="_appContainer_b3ogb_2",P="_verticalTabContainer_b3ogb_9",X="_active_b3ogb_30",q="_widgetContainer_b3ogb_38",K="_bordered_b3ogb_44",Q="_badge_b3ogb_48",p={appContainer:J,verticalTabContainer:P,active:X,widgetContainer:q,bordered:K,badge:Q},Z=[{svc:t.None,label:"Your App"},{svc:t.Team,label:"Team Chat"},{svc:t.Drive,label:"Drive"},{svc:t.Contacts,label:"Contacts"},{svc:t.Meet,label:"Meetings"}],ee=({setService:c,service:l,currentService:d,disabled:i,children:v})=>o.jsx("button",{type:"button",onClick:i?void 0:()=>c(l),disabled:i,className:d===l?p.active:void 0,style:{position:"relative"},children:v}),T=[50,51,52,53],te=({hideDashboardElements:c,setHideDashboardElements:l})=>{const d=()=>{l(c?void 0:T)};return o.jsx("div",{children:o.jsx("button",{type:"button",className:`${f.menuButton} ${f.hideDashboardElementsButton}`,onClick:d,children:`${c?"Show":"Hide"} Dashboard Elements`})})},oe=({hideDashboardElements:c,setHideDashboardElements:l})=>{const d=i=>{var S;const E=Array.from((S=i.target)==null?void 0:S.options).filter(u=>u.selected).map(u=>Number(u.value));l(E.length>0?E:void 0)};return o.jsx("div",{children:o.jsx("select",{multiple:!0,onChange:d,value:c||[],className:`${f.menuButton} ${f.multiSelectHideDashboardElements}`,children:T.map(i=>o.jsx("option",{value:i,children:i},i))})})},ae=()=>{H();const c=O(),[l,d]=n.useState(""),[i,v]=n.useState(!0),[E,S]=n.useState(0),[u,M]=n.useState(!1),[y,W]=n.useState(!1),[s,L]=n.useState(()=>{const e=c.hash.slice(1);return e in t?t[e]:t.None}),[B,I]=n.useState(!1),[x,w]=n.useState(void 0),j=n.useRef(),g=n.useRef(),r=n.useRef(),m=k(e=>e.credentials),D=n.useCallback((e,{domain:a,token:C,hostId:Y},$)=>{console.log("Widget loading");const R=N=>{const b=new A({domain:a,sso:{token:C,hostId:Y},container:e},N);return b.on("room.READY",()=>{console.log("Entered meeting")}),b.on("room.UNLOAD",()=>{var h;console.log("Left meeting: re-creating widget..."),(h=r.current)==null||h.unload(),r.current=R(),r.current.on("dashboard.READY",()=>{I(_=>!_)})}),b.on("dashboard.SESSION_EXPIRED",()=>{console.error("Widget error:","Session expired"),d("Session expired")}),b.on("widget.ERROR",h=>{console.error("Widget error:",h),d(JSON.stringify(h))}),b};r.current=R($),r.current.toggle(!1),r.current.on("dashboard.READY",()=>{M(!0),g.current=new A({domain:a,container:e},t.Team),g.current.toggle(!1),g.current.on("dashboard.UNREAD_MESSAGES",N=>{const b=Object.values(N.rooms).reduce((h,_)=>h+_,0);S(b)}),g.current.on("dashboard.READY",()=>{W(!0)})})},[]);n.useEffect(()=>{if(m.token&&m.domain&&m.hostId&&j.current)return D(j.current,m,s),()=>{var a,C;(a=r.current)==null||a.unload(),(C=g.current)==null||C.unload(),console.log("Widget unloaded")}},[m,D]),n.useEffect(()=>{u&&g.current.on("dashboard.NAVIGATE",e=>{const a=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${a}`)})},[u]),n.useEffect(()=>{var e,a;if((e=r.current)==null||e.toggle(!1),(a=g.current)==null||a.toggle(!1),v(s===t.None),s===t.None){console.log("Load your app"),window.history.pushState(null,"","#");return}s===t.Team?(g.current.toggle(!0),console.log("Load the team chat widget")):s===t.Meet?(r.current.toggle(!0),r.current.load(s,{hiddenElements:[]}),console.log("Load the Meet widget")):(r.current.toggle(!0),r.current.load(s),console.log(`Load the ${s} widget`)),window.history.pushState(null,"",`#${t[s]}`)},[s,B]),n.useEffect(()=>{var e;(e=r.current)==null||e.setHiddenElements(x)},[x]);const V=[p.widgetContainer,s!==t.None&&p.bordered].filter(Boolean).join(" ");return o.jsxs("div",{className:p.appContainer,children:[o.jsxs("div",{className:p.verticalTabContainer,children:[Z.map(({svc:e,label:a})=>o.jsxs(ee,{setService:L,service:e,currentService:s,disabled:!(e===t.Team?y:u),children:[a,e===t.Team&&o.jsx("span",{className:p.badge,children:E})]},e)),o.jsx(U,{error:l,isLoading:!u})]}),i&&o.jsx("div",{children:"Your app goes here"}),o.jsx(G,{position:"right"}),o.jsx(z,{position:"right"}),o.jsxs("div",{className:f.extraMenu,children:[s===t.Meet&&o.jsx(te,{hideDashboardElements:x,setHideDashboardElements:w}),s===t.Meet&&o.jsx(oe,{hideDashboardElements:x,setHideDashboardElements:w}),r.current&&o.jsx(F,{...m})]}),o.jsx("div",{ref:j,className:V})]})};export{ae as default};
