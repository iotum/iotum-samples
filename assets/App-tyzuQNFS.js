import{j as t,T as v,u as N,b as C,r as g,a as S,L as y}from"./index-UiNu7bxT.js";import{s as n,C as L}from"./ChatRoom-P_4PwGRv.js";import{M as O,a as B,D as k,S as w,L as M}from"./MenuButton-5YESuwXf.js";import{O as T}from"./OpenFullAppButton-d5gWhiqP.js";const A=({rooms:d,onRoomButtonClick:m,onRoomClose:u,children:a})=>t.jsxs("div",{className:n.container,children:[t.jsx("div",{className:n.roomListContainer,children:d.map(e=>t.jsx("div",{className:n.chatRoomItem,children:t.jsx("button",{onClick:()=>m(e.path),className:e.bool?n.active:"",children:e.name})},e.path))}),t.jsxs("div",{className:n.chatRoomsContainer,children:[d.map(e=>e.bool&&t.jsxs("div",{className:`${n.chatRoom} ${n.activeRoom}`,children:[t.jsx(L,{path:e.path}),t.jsx("button",{className:n.closeButton,onClick:()=>u(e.path),children:"x"})]},e.path)),t.jsx(v,{position:"right"}),t.jsx(O,{position:"right"}),a]})]}),D=()=>{N();const d=C(),[m,u]=g.useState(()=>JSON.parse(decodeURI(d.hash.slice(1))||"[]").map(s=>({path:s,bool:!0}))),a=S(s=>s.credentials),e=(s,p)=>{u(x=>{const c=x.map(o=>o.path===s?{...o,bool:p}:o),h=c.filter(o=>o.bool).map(o=>o.path);return window.history.pushState(null,"","#"+(h.length?JSON.stringify(h):"")),c})},R=({domain:s,token:p,hostId:x})=>{const c=new k({domain:s,sso:{token:p,hostId:x},container:"#chat"},w.Team,{layout:M.list,pathname:"/"});return c.once("dashboard.ROOM_LIST",h=>{var j;const o=[],b=Object.values(h.rooms).map(l=>{const i=l.accounts.map(r=>r.name);if(i.length===1){const r=`${i[0]} (you)`;return o.push(i[0]),{name:r,path:l.path,bool:!1}}return{name:i.filter(r=>!o.includes(r)).join(", "),path:l.path,bool:!1}});u(l=>b.map(i=>({...i,bool:!!l.find(f=>f.path===i.path)}))),(j=document.querySelector("#loading"))==null||j.remove()}),c};return g.useEffect(()=>{if(a&&a.token&&a.domain&&a.hostId){const s=R(a);return setTimeout(()=>s.toggle(!1)),()=>{s.unload()}}},[a]),t.jsxs("div",{children:[t.jsx("div",{id:"room-buttons",children:t.jsx(A,{rooms:m,onRoomButtonClick:s=>e(s,!0),onRoomClose:s=>e(s,!1),children:t.jsx("div",{className:B.extraMenu,children:t.jsx(T,{origin:`https://${a.domain}`})})})}),t.jsx("div",{id:"chat",children:t.jsx(y,{id:"loading"})})]})};export{D as default};
