import{u as E,r as c,a as _,j as e,T as k}from"./index-wUJeLWl4.js";import{d,M as S}from"./MenuButton-v_hvMF4P.js";const T="_chatContainer_17vrk_2",w="_badge_17vrk_12",A="_biggerButton_17vrk_26",g={chatContainer:T,badge:w,biggerButton:A},I=()=>{E();const[h,m]=c.useState(0),[b,f]=c.useState(!0),s=c.useRef(null),a=_(t=>t.credentials),u=a.token&&a.domain&&a.hostId,x=t=>{var n;if(u)if((n=s.current)!=null&&n.instance)s.current.instance.focus(),t();else{const{domain:r,token:l,hostId:o}=a;s.current=new d.Dashboard({domain:r,sso:{token:l,hostId:o},container:window,target:{name:"CallbridgeChatWidget",features:"width=800,height=600",checkExisting:!0}},d.Service.Team),s.current.on("dashboard.READY",t),s.current.on("dashboard.NAVIGATE",()=>{console.log("navigate event")})}},p=t=>{t.preventDefault();const{currentTarget:n}=t;n.disabled=!0;const r=setTimeout(()=>n.disabled=!1,2e3);x(()=>{clearTimeout(r),n.disabled=!1})};return c.useEffect(()=>{if(u){const t=document.createElement("div"),{domain:n,token:r,hostId:l}=a,o=new d.Dashboard({domain:n,sso:{token:r,hostId:l},container:t},d.Service.Team);return o.on("dashboard.UNREAD_MESSAGES",i=>{const j=Object.values(i.rooms).reduce((C,v)=>C+v,0);m(j),f(!1)}),()=>{var i;(i=s.current)==null||i.unload(),o==null||o.unload()}}},[u,a]),e.jsxs(e.Fragment,{children:[e.jsx(k,{position:"right"}),e.jsx(S,{position:"right"}),e.jsx("div",{className:g.chatContainer,children:b?e.jsx("div",{children:"Loading unread messages..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:g.biggerButton,onClick:p,children:"Chat"}),e.jsx("span",{className:g.badge,children:h})]})})]})};export{I as default};
