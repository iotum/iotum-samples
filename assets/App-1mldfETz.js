import{u as Y,b as H,r as n,a as I,j as o,L as k,T as O}from"./index-UiNu7bxT.js";import{S as t,D as T,M as U,a as f}from"./MenuButton-5YESuwXf.js";import{O as G}from"./OpenFullAppButton-d5gWhiqP.js";const z="_appContainer_b3ogb_2",F="_verticalTabContainer_b3ogb_9",q="_active_b3ogb_30",J="_widgetContainer_b3ogb_38",K="_bordered_b3ogb_44",P="_badge_b3ogb_48",b={appContainer:z,verticalTabContainer:F,active:q,widgetContainer:J,bordered:K,badge:P},Q=[{svc:t.None,label:"Your App"},{svc:t.Team,label:"Team Chat"},{svc:t.Drive,label:"Drive"},{svc:t.Contacts,label:"Contacts"},{svc:t.Meet,label:"Meetings"}],X=({setService:c,service:l,currentService:u,disabled:i,children:v})=>o.jsx("button",{type:"button",onClick:i?void 0:()=>c(l),disabled:i,className:u===l?b.active:void 0,style:{position:"relative"},children:v}),M=[50,51,52,53],Z=({hideDashboardElements:c,setHideDashboardElements:l})=>{const u=()=>{l(c?void 0:M)};return o.jsx("div",{children:o.jsx("button",{type:"button",className:`${f.menuButton} ${f.hideDashboardElementsButton}`,onClick:u,children:`${c?"Show":"Hide"} Dashboard Elements`})})},ee=({hideDashboardElements:c,setHideDashboardElements:l})=>{const u=i=>{var E;const g=Array.from((E=i.target)==null?void 0:E.options).filter(m=>m.selected).map(m=>Number(m.value));l(g.length>0?g:void 0)};return o.jsx("div",{children:o.jsx("select",{multiple:!0,onChange:u,value:c||[],className:`${f.menuButton} ${f.multiSelectHideDashboardElements}`,children:M.map(i=>o.jsx("option",{value:i,children:i},i))})})},se=()=>{Y();const c=H(),[l,u]=n.useState(!0),[i,v]=n.useState(0),[g,E]=n.useState(!1),[m,R]=n.useState(!1),[s,y]=n.useState(()=>{const e=c.hash.slice(1);return e in t?t[e]:t.None}),[B,L]=n.useState(!1),[C,w]=n.useState(void 0),j=n.useRef(),d=n.useRef(),a=n.useRef(),h=I(e=>e.credentials),D=n.useCallback((e,{domain:r,token:S,hostId:$},V)=>{console.log("Widget loading");const A=_=>{const p=new T({domain:r,sso:{token:S,hostId:$},container:e},_);return p.on("room.READY",()=>{console.log("Entered meeting")}),p.on("room.UNLOAD",()=>{var x;console.log("Left meeting: re-creating widget..."),(x=a.current)==null||x.unload(),a.current=A(),a.current.on("dashboard.READY",()=>{L(N=>!N)})}),p};a.current=A(V),a.current.toggle(!1),a.current.on("dashboard.READY",()=>{E(!0),d.current=new T({domain:r,container:e},t.Team),d.current.toggle(!1),d.current.on("dashboard.UNREAD_MESSAGES",_=>{const p=Object.values(_.rooms).reduce((x,N)=>x+N,0);v(p)}),d.current.on("dashboard.READY",()=>{R(!0)})})},[]);n.useEffect(()=>{if(h.token&&h.domain&&h.hostId&&j.current)return D(j.current,h,s),()=>{var r,S;(r=a.current)==null||r.unload(),(S=d.current)==null||S.unload(),console.log("Widget unloaded")}},[h,D]),n.useEffect(()=>{g&&d.current.on("dashboard.NAVIGATE",e=>{const r=e.pathname!=="/"?e.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${r}`)})},[g]),n.useEffect(()=>{var e,r;if((e=a.current)==null||e.toggle(!1),(r=d.current)==null||r.toggle(!1),u(s===t.None),s===t.None){console.log("Load your app"),window.history.pushState(null,"","#");return}s===t.Team?(d.current.toggle(!0),console.log("Load the team chat widget")):s===t.Meet?(a.current.toggle(!0),a.current.load(s,{hiddenElements:[]}),console.log("Load the Meet widget")):(a.current.toggle(!0),a.current.load(s),console.log(`Load the ${s} widget`)),window.history.pushState(null,"",`#${t[s]}`)},[s,B]),n.useEffect(()=>{var e;(e=a.current)==null||e.setHiddenElements(C)},[C]);const W=[b.widgetContainer,s!==t.None&&b.bordered].filter(Boolean).join(" ");return o.jsxs("div",{className:b.appContainer,children:[o.jsxs("div",{className:b.verticalTabContainer,children:[Q.map(({svc:e,label:r})=>o.jsxs(X,{setService:y,service:e,currentService:s,disabled:!(e===t.Team?m:g),children:[r,e===t.Team&&o.jsx("span",{className:b.badge,children:i})]},e)),!g&&o.jsx(k,{})]}),l&&o.jsx("div",{children:"Your app goes here"}),o.jsx(O,{position:"right"}),o.jsx(U,{position:"right"}),o.jsxs("div",{className:f.extraMenu,children:[s===t.Meet&&o.jsx(Z,{hideDashboardElements:C,setHideDashboardElements:w}),s===t.Meet&&o.jsx(ee,{hideDashboardElements:C,setHideDashboardElements:w}),a.current&&o.jsx(G,{origin:`https://${h.domain}`})]}),o.jsx("div",{ref:j,className:W})]})};export{se as default};
