import{r as n,j as e,u as w,a as W,T as y}from"./index-wUJeLWl4.js";import{d as s,M as A}from"./MenuButton-v_hvMF4P.js";const E="_appContainer_1p9bj_2",k="_verticalTabContainer_1p9bj_9",N="_widgetContainer_1p9bj_37",D="_badge_1p9bj_43",p={appContainer:E,verticalTabContainer:k,widgetContainer:N,badge:D},M=n.forwardRef(function(u,g){return e.jsx("div",{ref:g,className:p.widgetContainer})}),V=()=>{w();const[h,u]=n.useState(!0),[g,j]=n.useState(0),[f,m]=n.useState(!1),[d,v]=n.useState(!1),b=n.useRef(),a=n.useRef(),r=n.useRef(),c=W(t=>t.credentials),C=n.useCallback((t,{domain:o,token:i,hostId:x})=>{console.log("Widget loading"),r.current=new s.Dashboard({domain:o,sso:{token:i,hostId:x},container:t}),r.current.toggle(!1),r.current.on("dashboard.READY",()=>{a.current=new s.Dashboard({domain:o,container:t},s.Service.Team),a.current.toggle(!1),a.current.on("dashboard.UNREAD_MESSAGES",S=>{const R=Object.values(S.rooms).reduce((T,_)=>T+_,0);j(R)}),a.current.on("dashboard.READY",()=>{v(!0),m(!0)})})},[]);n.useEffect(()=>{if(c.token&&c.domain&&c.hostId&&b.current)return C(b.current,c),()=>{var o,i;(o=r.current)==null||o.unload(),(i=a.current)==null||i.unload(),console.log("Widget unloaded")}},[c,C]),n.useEffect(()=>{f&&a.current.on("dashboard.NAVIGATE",t=>{const o=t.pathname!=="/"?t.pathname:"an unspecified room";console.log(`The chat widget navigated to this room: ${o}`)})},[f]);const l=t=>{var o,i;(o=r.current)==null||o.toggle(!1),(i=a.current)==null||i.toggle(!1),t===s.Service.None?(u(!0),console.log("Load your app")):t===s.Service.Team?(a.current.toggle(!0),u(!1),console.log("Load the team chat widget")):(r.current.toggle(!0),r.current.load(t),u(!1),console.log(`Load the ${t} widget`))};return e.jsxs("div",{className:p.appContainer,children:[e.jsxs("div",{className:p.verticalTabContainer,children:[e.jsx("button",{type:"button",onClick:()=>l(s.Service.None),disabled:!d,children:"Your App"}),e.jsxs("button",{type:"button",onClick:()=>l(s.Service.Team),disabled:!d,style:{position:"relative"},children:["Team Chat",g>0&&e.jsx("span",{className:p.badge,children:g})]}),e.jsx("button",{type:"button",onClick:()=>l(s.Service.Drive),disabled:!d,children:"Drive"}),e.jsx("button",{type:"button",onClick:()=>l(s.Service.Contacts),disabled:!d,children:"Contacts"}),e.jsx("button",{type:"button",onClick:()=>l(s.Service.Meet),disabled:!d,children:"Meetings"})]}),h&&e.jsx("div",{children:"Your app goes here"}),!d&&e.jsx("div",{children:"The widgets are loading"}),e.jsx(y,{position:"right"}),e.jsx(A,{position:"right"}),e.jsx(M,{ref:b})]})};export{V as default};
